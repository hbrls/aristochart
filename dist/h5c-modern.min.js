var H5C=function(i,t,e){if(i&&i.DOCUMENT_NODE||(t=i,i=document.createElement("canvas")),!t||!t.data)throw new Error("Please provide some data to plot.");if(!t.data.y||!t.data.x)throw new Error("Please provide some data.x and data.y");t.width&&!t.height&&(t.height=Math.floor(.67*t.width)),this.defaults=H5C.themes["default"],this.options=t,this.canvas=i,this.theme=e,this.data=this.options.data,this.theme&&(this.defaults=H5C._deepMerge(this.defaults,this.theme));for(var s in this.defaults)this.options=H5C._deepMerge(this.defaults,this.options);for(var o in this.options.style)for(var s in this.options.style["default"])this.options.style[o]=H5C._deepMerge(this.options.style["default"],this.options.style[o]);if(this.indexes=[],l=this,["fill","axis","tick","line","point","label","title"].forEach(function(i){if(l.indexes[l.options[i].index])throw new Error("Conflicting indexes in H5C");l.indexes[l.options[i].index]=i}),this.indexes=this.indexes.filter(function(i){return i?!0:void 0}),this.canvas.getContext)this.ctx=this.canvas.getContext("2d");else{var n=document.createElement("canvas");this.canvas.appendChild(n),this.canvas=n,this.ctx=n.getContext("2d")}this.canvas.height=this.options.height,this.canvas.width=this.options.width,window.devicePixelRatio>1&&(this.canvas.style.height=this.canvas.height+"px",this.canvas.style.width=this.canvas.width+"px",this.canvas.height=this.canvas.height*window.devicePixelRatio,this.canvas.width=this.canvas.width*window.devicePixelRatio),this.resolution=window.devicePixelRatio||1;var l;this.update(),this.options.render&&this.render()};H5C._deepMerge=function(i,t){return function e(i,t){for(var s in i)void 0==t[s]?t[s]=i[s]:i[s]instanceof Object&&(t[s]=e(i[s],t[s]));return t}(i,t)},H5C.prototype._normalize=function(i,t){var e=null,s=null;return null!==i&&(e=this.box.x+i),null!==t&&(s=this.box.y1-t),[e,s]},H5C.themes={},H5C.prototype.initBox=function(){this.box={x:this.options.marginLeft,y:this.options.marginTop,x1:this.options.width-this.options.marginRight,y1:this.options.height-this.options.marginBottom}},H5C.prototype.initRange=function(){var i=this.data,t=[];Object.keys(i).forEach(function(e){"y"===e[0]&&(t=t.concat(i[e]))}),t.sort();var e=t.slice(-1)[0],s=t[0];this.y={max:void 0===this.options.axis.y.max?e:this.options.axis.y.max,min:void 0===this.options.axis.y.min?s:this.options.axis.y.min},this.y.range=this.y.max-this.y.min,"number"==typeof i.x?this.x={min:0,max:i.x}:2===i.x.length&&(this.x={min:i.x[0],max:i.x[1]}),this.x.range=this.x.max-this.x.min},H5C.prototype.initAxis=function(){var i=this.options.padding,t=this.box;this.axis={x:{x:t.x-i,y:t.y1+i,x1:t.x1+i,y1:t.y1+i},y:{x:t.x-i,y:t.y-i,x1:t.x-i,y1:t.y1+i}}},H5C.prototype.initPoints=function(){var i={},t=(this.x.max,this.x.min),e=this.x.range,s=this.y.max,o=this.y.min,n=this.y.range,l=this.box.x,a=this.box.y,h=this.box.x1,r=this.box.y1,x=a+r/n*s,c=l+h/e*Math.abs(t),f=this.data.tick,d=this,y=f.length-1,p=(this.box.x1-this.box.x)/y,v=(this.box.y1-this.box.y)/this.y.range;Object.keys(this.data).forEach(function(t){if("y"===t[0]){var e=d.data[t],s=e.map(function(i,t){var e=p*t,s=(i-o)*v,n=d._normalize(e,s);return{x:e,y:s,rx:n[0],ry:n[1]}});i[t]=s}}),this.lines=i,this.origin={x:c,y:x}},H5C.prototype.update=function(){var i=this.resolution;this.options.margin*=i,this.options.marginTop*=i,this.options.marginBottom*=i,this.options.marginLeft*=i,this.options.marginRight*=i,this.options.width*=i,this.options.height*=i,this.initBox(),this.initRange(),this.initAxis(),this.initPoints()},H5C.prototype.render=function(){var i=this,t=this.lines,e=this.origin,s=this.axis,o=i.options.style["default"];this.canvas.width=this.canvas.width;var n=this.data.tick,l=n.length,a=n.length,h=a-1,r=Math.floor(this.options.axis.y.steps),x=r+1,c=r,f=(this.options.padding,this.box),d=e.x,y=e.y;this.indexes.forEach(function(e){switch(e){case"point":break;case"axis":o.axis.visible&&(o.axis.x.visible&&i.options.axis.x.render.call(i,o,s.x.x,o.axis.y.fixed?s.x.y:y,s.x.x1,o.axis.y.fixed?s.x.y1:y,"x"),o.axis.y.visible&&i.options.axis.y.render.call(i,o,o.axis.x.fixed?s.y.x:d,s.y.y,o.axis.x.fixed?s.y.x1:d,s.y.y1,"y"));break;case"line":Object.keys(t).forEach(function(e){var s=i.options.style[e]||o;s.line.visible&&i.options.line.render.call(i,s,t[e])});break;case"tick":if(o.tick.visible){for(var p=(f.x1-f.x)/h,v=(f.y1-f.y)/r,b=0;a>b;b++){var u=i._normalize(p*b,null);i.options.tick.render.call(i,o,u[0],o.tick.x.fixed?s.x.y1:y,"x",b,null===n[b]?"none":"#"===n[b][0]?"major":"minor")}for(var b=0;r+1>b;b++){var u=i._normalize(null,v*b);i.options.tick.render.call(i,o,o.tick.y.fixed?s.y.x1:d,u[1],"y",b,b%2===0?"major":"minor")}}break;case"label":var p=(f.x1-f.x)/h,v=(f.y1-f.y)/c;if(o.label.x.visible)for(var b=0;l+1>b;b++){var u=i._normalize(p*b,null);i.options.label.render.call(i,o,n[b],u[0],o.label.x.fixed?s.x.y1:y,"x",b)}if(o.label.y.visible)for(var b=0;x>b;b++){var m=i.y.min+i.y.range/c*b,u=i._normalize(null,v*b);i.options.label.render.call(i,o,m,o.label.y.fixed?s.y.x1:d,u[1],"y",b)}break;case"fill":Object.keys(t).forEach(function(e){var s=i.options.style[e]||o;(s.line.fill||s.line.fillGradient)&&i.options.fill.render.call(i,s,t[e])});break;case"title":if(o.title.visible){var g=(i.options.title.x,i.options.title.y),u=i._normalize(0,i.box.y1-i.box.y);o.title.y.visible&&i.options.title.render.call(i,o,g,u[0],u[1],"y")}break;default:throw new Error("invalid feature!")}})},H5C.point={circle:function(i,t,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=i.point.stroke,this.ctx.lineWidth=i.point.width*this.resolution,this.ctx.fillStyle=i.point.fill,this.ctx.beginPath(),this.ctx.arc(t,e,i.point.radius*this.resolution,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}},H5C.line={line:function(i,t){this.ctx.save(),this.ctx.strokeStyle=i.line.stroke,this.ctx.lineWidth=i.line.width*this.resolution,this.ctx.beginPath(),this.ctx.moveTo(t[0].rx,t[0].ry);var e=this;t.forEach(function(i){e.ctx.lineTo(i.rx,i.ry)}),this.ctx.stroke(),this.ctx.restore()},fill:function(i,t){if(this.ctx.save(),i.line.fillGradient){var e=this.ctx.createLinearGradient((this.box.x+this.box.x1)/2,this.box.y,(this.box.x+this.box.x1)/2,this.box.y1);e.addColorStop(0,i.line.fillGradient[0]),e.addColorStop(.5,i.line.fillGradient[1]),e.addColorStop(.9,i.line.fillGradient[2]),e.addColorStop(1,i.line.fillGradient[3]),this.ctx.fillStyle=e}else this.ctx.fillStyle=i.line.fill;this.ctx.beginPath(),this.ctx.moveTo(t[0].rx,t[0].ry);var s=this;t.forEach(function(i){s.ctx.lineTo(i.rx,i.ry)}),this.ctx.lineTo(t[t.length-1].rx,this.box.y1+(i.line.fillToBaseLine?this.options.padding:0)),this.ctx.lineTo(t[0].rx,this.box.y1+(i.line.fillToBaseLine?this.options.padding:0)),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}},H5C.tick={line:function(i,t,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=i.tick.stroke,this.ctx.lineWidth=i.tick.width*this.resolution,this.ctx.beginPath();var l=0;if("major"===n?l=i.tick.major:"minor"===n&&(l=i.tick.minor),l>0){l*=this.resolution;var a=t,h=e;switch(i.tick.align){case"middle":"x"==s&&(h=e-l/2),"y"==s&&(a=t-l/2);break;case"inside":"x"==s&&(h=e-l),a=t;break;case"outside":"x"==s&&(h=e),"y"==s&&(a=t-l)}this.ctx.moveTo(a,h),"x"===s?this.ctx.lineTo(a,h+l):"y"===s&&this.ctx.lineTo(a+l,h),this.ctx.stroke(),this.ctx.restore()}}},H5C.axis={line:function(i,t,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=i.axis.stroke,this.ctx.lineWidth=i.axis.width*this.resolution,this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(s,o),this.ctx.stroke(),this.ctx.restore()}},H5C.label={text:function(i,t,e,s,o,n){if(n%this.options.label[o].step==0){var l=i.label[o];"x"==o&&(s+=(i.tick.major+l.offsetY)*this.resolution),"y"==o&&(e-=(i.tick.major+l.offsetX)*this.resolution,s+=l.offsetY*this.resolution),this.ctx.font=l.fontStyle+" "+l.fontSize*this.resolution+"px "+l.font,this.ctx.fillStyle=l.color,this.ctx.textAlign=l.align,this.ctx.textBaseline=l.baseline,"x"===o?t&&("#"===t[0]&&(t=t.substring(1)),this.ctx.fillText(t,e,s)):"y"===o&&(t=t.toFixed(i.label.y.precision||2),t+=i.label.y.suffix||"",this.ctx.fillText(t,e,s))}}},H5C.title={text:function(i,t,e,s,o){this.ctx.save(),"x"==o&&(s+=i.title.x.offsetY,e+=i.title.x.offsetX),"y"===o&&(s+=i.title.y.offsetY,e+=i.title.y.offsetX),this.ctx.font=i.title.fontStyle+" "+i.title.fontSize*this.resolution+"px "+i.title.font,this.ctx.fillStyle=i.title.color,this.ctx.translate(e,s),this.ctx.fillText(t,0,0),this.ctx.restore()}},H5C.themes.modern={width:640,height:400,padding:0,render:!0,fill:{index:0,render:H5C.line.fill,fillToBaseLine:!0},axis:{index:1,render:H5C.axis.line,x:{steps:5,render:H5C.axis.line},y:{steps:5,render:H5C.axis.line}},tick:{index:2,render:H5C.tick.line},line:{index:3,render:H5C.line.line},point:{index:4,render:H5C.point.circle},label:{index:5,render:H5C.label.text,x:{step:1},y:{step:1}},title:{index:6,render:H5C.title.text,x:"x",y:"y"},style:{"default":{point:{visible:!1},line:{stroke:"#e64742",width:2,fillGradient:["rgba(246, 168, 168, 0.9)","rgba(246, 168, 168, 0.4)","rgba(246, 168, 168, 0.1)","rgba(246, 168, 168, 0)"],visible:!0},axis:{stroke:"#ccc",width:1,visible:!0,x:{visible:!0,fixed:!0},y:{visible:!0,fixed:!0,suffix:null}},tick:{align:"outside",stroke:"#ccc",width:1,minor:4,major:8,visible:!0,x:{fixed:!0},y:{fixed:!0}},label:{x:{font:"Helvetica",fontSize:12,fontStyle:"normal",color:"#7f7f7f",align:"center",baseline:"bottom",offsetY:20,offsetX:3,visible:!0,fixed:!0},y:{font:"Helvetica",fontSize:12,fontStyle:"normal",color:"#7f7f7f",align:"center",baseline:"bottom",offsetY:8,offsetX:12,visible:!0,fixed:!0,precision:2,suffix:null}},title:{color:"#777",font:"georgia",fontSize:"16",fontStyle:"normal",visible:!0,x:{offsetX:0,offsetY:120,visible:!1},y:{offsetX:-135,offsetY:10,visible:!0}}}}};