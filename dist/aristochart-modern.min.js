var Aristochart=function(t,i,e){if(t&&t.DOCUMENT_NODE||(i=t,t=document.createElement("canvas")),!i||!i.data)throw new Error("Please provide some data to plot.");if(!i.data.y||!i.data.x)throw new Error("Please provide some data.x and data.y");i.width&&!i.height&&(i.height=Math.floor(.67*i.width)),this.defaults=Aristochart.themes["default"],this.options=i,this.canvas=t,this.theme=e,this.data=this.options.data,this.theme&&(this.defaults=Aristochart._deepMerge(this.defaults,this.theme));for(var s in this.defaults)this.options=Aristochart._deepMerge(this.defaults,this.options);for(var o in this.options.style)for(var s in this.options.style["default"])this.options.style[o]=Aristochart._deepMerge(this.options.style["default"],this.options.style[o]);if(this.indexes=[],r=this,["fill","axis","tick","line","point","label","title"].forEach(function(t){if(r.indexes[r.options[t].index])throw new Error("Conflicting indexes in Aristochart");r.indexes[r.options[t].index]=t}),this.indexes=this.indexes.filter(function(t){return t?!0:void 0}),this.canvas.getContext)this.ctx=this.canvas.getContext("2d");else{var n=document.createElement("canvas");this.canvas.appendChild(n),this.canvas=n,this.ctx=n.getContext("2d")}this.canvas.height=this.options.height,this.canvas.width=this.options.width,window.devicePixelRatio>1&&(this.canvas.style.height=this.canvas.height+"px",this.canvas.style.width=this.canvas.width+"px",this.canvas.height=this.canvas.height*window.devicePixelRatio,this.canvas.width=this.canvas.width*window.devicePixelRatio),this.resolution=window.devicePixelRatio||1;var r;this.update(),this.options.render&&this.render()};Aristochart._deepMerge=function(t,i){return function e(t,i){for(var s in t)void 0==i[s]?i[s]=t[s]:t[s]instanceof Object&&(i[s]=e(t[s],i[s]));return i}(t,i)},Aristochart.prototype._normalize=function(t,i){var e=null,s=null;return null!==t&&(e=this.box.x+t),null!==i&&(s=this.box.y1-i),[e,s]},Aristochart.themes={},Aristochart.prototype.initBox=function(){this.box={x:this.options.margin,y:this.options.margin,x1:this.options.width-this.options.margin,y1:this.options.height-this.options.margin}},Aristochart.prototype.initRange=function(){var t=this.data,i=[];Object.keys(t).forEach(function(e){"y"===e[0]&&(i=i.concat(t[e]))}),i.sort();var e=i.slice(-1)[0],s=i[0];this.y={max:void 0===this.options.axis.y.max?e:this.options.axis.y.max,min:void 0===this.options.axis.y.min?s:this.options.axis.y.min},this.y.range=this.y.max-this.y.min,"number"==typeof t.x?this.x={min:0,max:t.x}:2===t.x.length&&(this.x={min:t.x[0],max:t.x[1]}),this.x.range=this.x.max-this.x.min},Aristochart.prototype.initAxis=function(){var t=this.options.padding,i=this.box;this.axis={x:{x:i.x-t,y:i.y1+t,x1:i.x1+t,y1:i.y1+t},y:{x:i.x-t,y:i.y-t,x1:i.x-t,y1:i.y1+t}}},Aristochart.prototype.initPoints=function(){var t={},i=(this.x.max,this.x.min),e=this.x.range,s=this.y.max,o=this.y.min,n=this.y.range,r=this.box.x,a=this.box.y,h=this.box.x1,l=this.box.y1,x=a+l/n*s,c=r+h/e*Math.abs(i),f=this.data.tick,d=this,y=f.length-1,p=(this.box.x1-this.box.x)/y,v=(this.box.y1-this.box.y)/this.y.range;Object.keys(this.data).forEach(function(i){if("y"===i[0]){var e=d.data[i],s=e.map(function(t,i){var e=p*i,s=(t-o)*v,n=d._normalize(e,s);return{x:e,y:s,rx:n[0],ry:n[1]}});t[i]=s}}),this.lines=t,this.origin={x:c,y:x}},Aristochart.prototype.update=function(){var t=this.resolution;this.options.margin*=t,this.options.padding*=t,this.options.width*=t,this.options.height*=t,this.initBox(),this.initRange(),this.initAxis(),this.initPoints()},Aristochart.prototype.render=function(){var t=this,i=this.lines,e=this.origin,s=this.axis,o=t.options.style["default"];this.canvas.width=this.canvas.width;var n=this.data.tick,r=n.length,a=n.length,h=a-1,l=Math.floor(this.options.axis.y.steps),x=l+1,c=l,f=(this.options.padding,this.box),d=e.x,y=e.y;this.ctx.save(),this.ctx.strokeStyle="blue",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(140,140),this.ctx.lineTo(1140,660),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.strokeStyle="green",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(200,200),this.ctx.stroke(),this.ctx.restore(),this.indexes.forEach(function(e){switch(e){case"point":break;case"axis":o.axis.visible&&(o.axis.x.visible&&t.options.axis.x.render.call(t,o,s.x.x,o.axis.y.fixed?s.x.y:y,s.x.x1,o.axis.y.fixed?s.x.y1:y,"x"),o.axis.y.visible&&t.options.axis.y.render.call(t,o,o.axis.x.fixed?s.y.x:d,s.y.y,o.axis.x.fixed?s.y.x1:d,s.y.y1,"y"));break;case"line":Object.keys(i).forEach(function(e){var s=t.options.style[e]||o;s.line.visible&&t.options.line.render.call(t,s,i[e])});break;case"tick":if(o.tick.visible){for(var p=(f.x1-f.x)/h,v=(f.y1-f.y)/l,b=0;a>b;b++){var u=t._normalize(p*b,null);t.options.tick.render.call(t,o,u[0],o.tick.x.fixed?s.x.y1:y,"x",b,null===n[b]?"none":"#"===n[b][0]?"major":"minor")}for(var b=0;l+1>b;b++){var u=t._normalize(null,v*b);t.options.tick.render.call(t,o,o.tick.y.fixed?s.y.x1:d,u[1],"y",b,b%2===0?"major":"minor")}}break;case"label":var p=(f.x1-f.x)/h,v=(f.y1-f.y)/c;if(o.label.x.visible)for(var b=0;r+1>b;b++){var u=t._normalize(p*b,null);t.options.label.render.call(t,o,n[b],u[0],o.label.x.fixed?s.x.y1:y,"x",b)}if(o.label.y.visible)for(var b=0;x>b;b++){var m=t.y.min+t.y.range/c*b,u=t._normalize(null,v*b);t.options.label.render.call(t,o,m,o.label.y.fixed?s.y.x1:d,u[1],"y",b)}break;case"fill":Object.keys(i).forEach(function(e){var s=t.options.style[e]||o;(s.line.fill||s.line.fillGradient)&&t.options.fill.render.call(t,s,i[e])});break;case"title":if(o.title.visible){var g=t.options.title.x,k=t.options.title.y;o.title.x.visible&&t.options.title.render.call(t,o,g,(2*t.box.x+t.box.x1)/2,t.box.y+t.box.y1,"x"),o.title.y.visible&&t.options.title.render.call(t,o,k,t.box.x,(2*t.box.y+t.box.y1)/2,"y")}break;default:throw new Error("invalid feature!")}})},Aristochart.point={circle:function(t,i,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=t.point.stroke,this.ctx.lineWidth=t.point.width*this.resolution,this.ctx.fillStyle=t.point.fill,this.ctx.beginPath(),this.ctx.arc(i,e,t.point.radius*this.resolution,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}},Aristochart.line={line:function(t,i){this.ctx.save(),this.ctx.strokeStyle=t.line.stroke,this.ctx.lineWidth=t.line.width*this.resolution,this.ctx.beginPath(),this.ctx.moveTo(i[0].rx,i[0].ry);var e=this;i.forEach(function(t){e.ctx.lineTo(t.rx,t.ry)}),this.ctx.stroke(),this.ctx.restore()},fill:function(t,i){if(this.ctx.save(),t.line.fillGradient){var e=this.ctx.createLinearGradient((this.box.x+this.box.x1)/2,this.box.y,(2*this.box.x+this.box.x1)/3,this.box.y1);e.addColorStop(0,t.line.fillGradient[0]),e.addColorStop(.2,t.line.fillGradient[1]),e.addColorStop(.75,t.line.fillGradient[2]),e.addColorStop(1,t.line.fillGradient[3]),this.ctx.fillStyle=e}else this.ctx.fillStyle=t.line.fill;this.ctx.beginPath(),this.ctx.moveTo(i[0].rx,i[0].ry);var s=this;i.forEach(function(t){s.ctx.lineTo(t.rx,t.ry)}),this.ctx.lineTo(i[i.length-1].rx,this.box.y1+(t.line.fillToBaseLine?this.options.padding:0)),this.ctx.lineTo(i[0].rx,this.box.y1+(t.line.fillToBaseLine?this.options.padding:0)),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}},Aristochart.tick={line:function(t,i,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=t.tick.stroke,this.ctx.lineWidth=t.tick.width*this.resolution,this.ctx.beginPath();var r=0;if("major"===n?r=t.tick.major:"minor"===n&&(r=t.tick.minor),r>0){r*=this.resolution;var a=i,h=e;switch(t.tick.align){case"middle":"x"==s&&(h=e-r/2),"y"==s&&(a=i-r/2);break;case"inside":"x"==s&&(h=e-r),a=i;break;case"outside":"x"==s&&(h=e),"y"==s&&(a=i-r)}this.ctx.moveTo(a,h),"x"===s?this.ctx.lineTo(a,h+r):"y"===s&&this.ctx.lineTo(a+r,h),this.ctx.stroke(),this.ctx.restore()}}},Aristochart.axis={line:function(t,i,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=t.axis.stroke,this.ctx.lineWidth=t.axis.width*this.resolution,this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(s,o),this.ctx.stroke(),this.ctx.restore()}},Aristochart.label={text:function(t,i,e,s,o,n){if(n%this.options.label[o].step==0){var r=t.label[o];"x"==o&&(s+=(t.tick.major+r.offsetY)*this.resolution),"y"==o&&(e-=(t.tick.major+r.offsetX)*this.resolution,s+=r.offsetY*this.resolution),this.ctx.font=r.fontStyle+" "+r.fontSize*this.resolution+"px "+r.font,this.ctx.fillStyle=r.color,this.ctx.textAlign=r.align,this.ctx.textBaseline=r.baseline,i&&("#"===i[0]&&(i=i.substring(1)),this.ctx.fillText(i,e,s))}}},Aristochart.title={text:function(t,i,e,s,o){this.ctx.save(),"x"==o&&(s+=t.title.x.offsetY,e+=t.title.x.offsetX),"y"==o&&(s+=t.title.y.offsetY,e+=t.title.y.offsetX),this.ctx.font=t.title.fontStyle+" "+t.title.fontSize*this.resolution+"px "+t.title.font,this.ctx.fillStyle=t.title.color,this.ctx.translate(e,s),"y"==o&&this.ctx.rotate(Math.PI/2),this.ctx.fillText(i,0,0),this.ctx.restore()}},Aristochart.themes.modern={width:640,height:400,margin:70,padding:0,render:!0,fill:{index:0,render:Aristochart.line.fill,fillToBaseLine:!0},axis:{index:1,render:Aristochart.axis.line,x:{steps:5,render:Aristochart.axis.line},y:{steps:5,render:Aristochart.axis.line}},tick:{index:2,render:Aristochart.tick.line},line:{index:3,render:Aristochart.line.line},point:{index:4,render:Aristochart.point.circle},label:{index:5,render:Aristochart.label.text,x:{step:1},y:{step:1}},title:{index:6,render:Aristochart.title.text,x:"x",y:"y"},style:{"default":{point:{visible:!1},line:{stroke:"#e64742",width:2,fillGradient:["rgba(246, 168, 168, 1)","rgba(246, 168, 168, 0.9)","rgba(246, 168, 168, 0.1)","rgba(246, 168, 168, 0)"],visible:!0},axis:{stroke:"#ccc",width:1,visible:!0,x:{visible:!0,fixed:!0},y:{visible:!0,fixed:!0}},tick:{align:"outside",stroke:"#ccc",width:1,minor:4,major:8,visible:!0,x:{fixed:!0},y:{fixed:!0}},label:{x:{font:"Helvetica",fontSize:12,fontStyle:"normal",color:"#7f7f7f",align:"center",baseline:"bottom",offsetY:20,offsetX:3,visible:!0,fixed:!0},y:{font:"Helvetica",fontSize:12,fontStyle:"normal",color:"#7f7f7f",align:"center",baseline:"bottom",offsetY:8,offsetX:12,visible:!0,fixed:!0}},title:{color:"#777",font:"georgia",fontSize:"16",fontStyle:"italic",visible:!1,x:{offsetX:0,offsetY:120,visible:!0},y:{offsetX:-135,offsetY:10,visible:!0}}}}};