var Aristochart=function(t,i,e){if(t&&t.DOCUMENT_NODE||(i=t,t=document.createElement("canvas")),!i||!i.data)throw new Error("Please provide some data to plot.");if(!i.data.y||!i.data.x)throw new Error("Please provide some data.x and data.y");i.width&&!i.height&&(i.height=Math.floor(.67*i.width)),this.defaults=Aristochart.themes["default"],this.options=i,this.canvas=t,this.theme=e,this.data=this.options.data,this.theme&&(this.defaults=Aristochart._deepMerge(this.defaults,this.theme));for(var s in this.defaults)this.options=Aristochart._deepMerge(this.defaults,this.options);for(var o in this.options.style)for(var s in this.options.style["default"])this.options.style[o]=Aristochart._deepMerge(this.options.style["default"],this.options.style[o]);if(this.indexes=[],that=this,["fill","axis","tick","line","point","label","title"].forEach(function(t){if(that.indexes[that.options[t].index])throw new Error("Conflicting indexes in Aristochart");that.indexes[that.options[t].index]=t}),this.indexes=this.indexes.filter(function(t){return t?!0:void 0}),this.canvas.getContext)this.ctx=this.canvas.getContext("2d");else{var n=document.createElement("canvas");this.canvas.appendChild(n),this.canvas=n,this.ctx=n.getContext("2d")}this.canvas.height=this.options.height,this.canvas.width=this.options.width,window.devicePixelRatio>1&&(this.canvas.style.height=this.canvas.height+"px",this.canvas.style.width=this.canvas.width+"px",this.canvas.height=this.canvas.height*window.devicePixelRatio,this.canvas.width=this.canvas.width*window.devicePixelRatio),this.resolution=window.devicePixelRatio||1,this.update(),this.options.render&&this.render()};Aristochart._deepMerge=function(t,i){return function e(t,i){for(var s in t)void 0==i[s]?i[s]=t[s]:t[s]instanceof Object&&(i[s]=e(t[s],i[s]));return i}(t,i)},Aristochart.prototype.refreshBounds=function(){var t=-(1/0),i=1/0;for(var e in this.data)if("x"!==e){var s=-(1/0),o=1/0;this.data[e].forEach(function(t){t>s&&(s=t),o>t&&(o=t)}),t=s>t?s:t,i=i>o?o:i}this.y={max:void 0==this.options.axis.y.max?t:this.options.axis.y.max,min:void 0==this.options.axis.y.min?i:this.options.axis.y.min},this.y.range=this.y.max-this.y.min,1==this.data.x.length||"number"==typeof this.data.x?this.x={min:0,max:this.data.x[0]||this.data.x}:this.x={min:this.data.x[0],max:this.data.x[this.data.x.length-1]},this.x.range=this.x.max-this.x.min},Aristochart.prototype.update=function(){var t=this.resolution;this.options.margin*=t,this.options.padding*=t,this.options.width*=t,this.options.height*=t,this.box={x:this.options.margin,y:this.options.margin,x1:this.options.width-2*this.options.margin,y1:this.options.height-2*this.options.margin},this.refreshBounds();var i=this.getPoints();this.lines=i.lines,this.origin=i.origin;var e=this.options.padding,s=this.box;this.axis={x:{x:s.x-e,y:s.y+s.y1+e,x1:that.box.x+s.x1+e,y1:s.y+s.y1+e},y:{x:s.x-e,y:s.y-e,x1:s.x-e,y1:s.y+s.y1+e}}},Aristochart.prototype.render=function(){var t=this,i=this.lines,e=this.origin,s=this.axis,o=t.options.style["default"];this.canvas.width=this.canvas.width;var n=Math.floor(this.options.axis.x.steps),a=Math.floor(this.options.axis.y.steps),r=(this.options.padding,this.box,e.x),h=e.y;this.indexes.forEach(function(e){switch(e){case"point":for(var l in i)(t.options.style[l]||o).point.visible&&i[l].forEach(function(i){t.options.point.render.call(t,t.options.style[l]||o,i.rx,i.ry,i.x,i.y,i.graph)});break;case"axis":o.axis.visible&&(o.axis.x.visible&&t.options.axis.x.render.call(t,o,s.x.x,o.axis.y.fixed?s.x.y:h,s.x.x1,o.axis.y.fixed?s.x.y1:h,"x"),o.axis.y.visible&&t.options.axis.y.render.call(t,o,o.axis.x.fixed?s.y.x:r,s.y.y,o.axis.x.fixed?s.y.x1:r,s.y.y1,"y"));break;case"line":for(var l in i){var x=t.options.style[l]||o;x.line.visible&&t.options.line.render.call(t,x,i[l])}break;case"tick":if(o.tick.visible){for(var c=t.box.x1/n,d=t.box.y1/a,f=0;n+1>f;f++)t.options.tick.render.call(t,o,t.box.x+c*f,o.tick.x.fixed?s.x.y1:h,"x",f);for(var f=0;a+1>f;f++)t.options.tick.render.call(t,o,o.tick.y.fixed?s.y.x1:r,t.box.y+d*f,"y",f)}break;case"label":var c=t.box.x1/n,d=t.box.y1/a;if(o.label.x.visible)for(var f=0;n+1>f;f++)t.options.label.render.call(t,o,t.x.min+(t.x.max-t.x.min)/n*f,t.box.x+c*f,o.label.x.fixed?s.x.y1:h,"x",f);if(o.label.y.visible)for(var f=0;a+1>f;f++){var y=a-f,p=t.y.min+(t.y.max-t.y.min)/a*y;t.options.label.render.call(t,o,p,o.label.y.fixed?s.y.x1:r,t.box.y+d*f,"y",f)}break;case"fill":for(var l in i){var x=t.options.style[l]||o;x.line.fill&&t.options.fill.render.call(t,x,i[l])}break;case"title":if(o.title.visible){var v=t.options.title.x,b=t.options.title.y;o.title.x.visible&&t.options.title.render.call(t,o,v,(2*t.box.x+t.box.x1)/2,t.box.y+t.box.y1,"x"),o.title.y.visible&&t.options.title.render.call(t,o,b,t.box.x,(2*t.box.y+t.box.y1)/2,"y")}}})},Aristochart.prototype.getPoints=function(t){var i={},e=(this.x.max,this.x.min),s=this.x.range,o=this.y.max,n=(this.y.min,this.y.range),a=this.box.x,r=this.box.y,h=this.box.x1,l=this.box.y1,x=r+l/n*o,c=a+h/s*Math.abs(e);for(var d in this.data)if("x"!=d){i[d]=[];var f=this.data[d],y=f.length,p=1;y>1e3&&(p=5),y>1e4&&(p=50),y>1e5&&(p=5e3);for(var v=y/p,b=0;v>b;b++){var g=s/(v-1)*b+e,u=f[b],m=c+h/s*g,k=x-l/n*u;i[d].push({x:g,y:u,rx:m,ry:k}),t&&t(m,k,g,u,d)}}return{lines:i,origin:{x:c,y:x}}},Aristochart.themes={},Aristochart.point={circle:function(t,i,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=t.point.stroke,this.ctx.lineWidth=t.point.width*this.resolution,this.ctx.fillStyle=t.point.fill,this.ctx.beginPath(),this.ctx.arc(i,e,t.point.radius*this.resolution,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}},Aristochart.line={line:function(t,i){this.ctx.save(),this.ctx.strokeStyle=t.line.stroke,this.ctx.lineWidth=t.line.width*this.resolution,this.ctx.beginPath(),this.ctx.moveTo(i[0].rx,i[0].ry);var e=this;i.forEach(function(t){e.ctx.lineTo(t.rx,t.ry)}),this.ctx.stroke(),this.ctx.restore()},fill:function(t,i){this.ctx.save(),this.ctx.fillStyle=t.line.fill,this.ctx.beginPath(),this.ctx.moveTo(i[0].rx,i[0].ry);var e=this;i.forEach(function(t){e.ctx.lineTo(t.rx,t.ry)}),this.ctx.lineTo(i[i.length-1].rx,this.box.y+this.box.y1+(t.line.fillToBaseLine?this.options.padding:0)),this.ctx.lineTo(i[0].rx,this.box.y+this.box.y1+(t.line.fillToBaseLine?this.options.padding:0)),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}},Aristochart.tick={line:function(t,i,e,s,o){this.ctx.save(),this.ctx.strokeStyle=t.tick.stroke,this.ctx.lineWidth=t.tick.width*this.resolution,this.ctx.beginPath();var n=o%2==0?t.tick.major:t.tick.minor;n*=this.resolution;var a=i,r=e;switch(t.tick.align){case"middle":"x"==s&&(r=e-n/2),"y"==s&&(a=i-n/2);break;case"inside":"x"==s&&(r=e-n),a=i;break;case"outside":"x"==s&&(r=e),"y"==s&&(a=i-n)}this.ctx.moveTo(a,r),"x"==s?this.ctx.lineTo(a,r+n):this.ctx.lineTo(a+n,r),this.ctx.stroke(),this.ctx.restore()}},Aristochart.axis={line:function(t,i,e,s,o,n){this.ctx.save(),this.ctx.strokeStyle=t.axis.stroke,this.ctx.lineWidth=t.axis.width*this.resolution,this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(s,o),this.ctx.stroke(),this.ctx.restore()}},Aristochart.label={text:function(t,i,e,s,o,n){if(n%this.options.label[o].step==0){var a=t.label[o];"x"==o&&(s+=(t.tick.major+a.offsetY)*this.resolution),"y"==o&&(e-=(t.tick.major+a.offsetX)*this.resolution,s+=a.offsetY*this.resolution),this.ctx.font=a.fontStyle+" "+a.fontSize*this.resolution+"px "+a.font,this.ctx.fillStyle=a.color,this.ctx.textAlign=a.align,this.ctx.textBaseline=a.baseline;var r=/^~(.*)/,h=/(\-?\d+(\.\d)?)/,l="";l=r.test(i)?[i.substring(1)]:h.test(i)?h.exec(i):[],this.ctx.fillText(l[0],e,s)}}},Aristochart.title={text:function(t,i,e,s,o){this.ctx.save(),"x"==o&&(s+=t.title.x.offsetY,e+=t.title.x.offsetX),"y"==o&&(s+=t.title.y.offsetY,e+=t.title.y.offsetX),this.ctx.font=t.title.fontStyle+" "+t.title.fontSize*this.resolution+"px "+t.title.font,this.ctx.fillStyle=t.title.color,this.ctx.translate(e,s),"y"==o&&this.ctx.rotate(Math.PI/2),this.ctx.fillText(i,0,0),this.ctx.restore()}},Aristochart.themes["default"]={width:640,height:400,margin:70,padding:20,render:!0,fill:{index:0,render:Aristochart.line.fill,fillToBaseLine:!0},axis:{index:1,render:Aristochart.axis.line,x:{steps:5,render:Aristochart.axis.line},y:{steps:10,render:Aristochart.axis.line}},tick:{index:2,render:Aristochart.tick.line},line:{index:3,render:Aristochart.line.line},point:{index:4,render:Aristochart.point.circle},label:{index:5,render:Aristochart.label.text,x:{step:1},y:{step:1}},title:{index:6,render:Aristochart.title.text,x:"x",y:"y"},style:{"default":{point:{stroke:"#000",fill:"#fff",radius:4,width:3,visible:!0},line:{stroke:"#298281",width:3,fill:"rgba(150, 215, 226, 0.4)",visible:!0},axis:{stroke:"#ddd",width:3,visible:!0,x:{visible:!0,fixed:!0},y:{visible:!0,fixed:!0}},tick:{align:"middle",stroke:"#ddd",width:2,minor:10,major:15,visible:!0,x:{fixed:!0},y:{fixed:!0}},label:{x:{font:"Helvetica",fontSize:14,fontStyle:"normal",color:"#000",align:"center",baseline:"bottom",offsetY:8,offsetX:3,visible:!0,fixed:!0},y:{font:"Helvetica",fontSize:10,fontStyle:"normal",color:"#000",align:"center",baseline:"bottom",offsetY:8,offsetX:8,visible:!0,fixed:!0}},title:{color:"#777",font:"georgia",fontSize:"16",fontStyle:"italic",visible:!0,x:{offsetX:0,offsetY:120,visible:!0},y:{offsetX:-135,offsetY:10,visible:!0}}}}};